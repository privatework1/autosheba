$(function() {
  "use strict";

  $(".preloader").fadeOut();
  // ============================================================== 
  // Theme options
  // ==============================================================     
  // ============================================================== 
  // sidebar-hover
  // ==============================================================

  $(".left-sidebar").hover(
      function() {
          $(".navbar-header").addClass("expand-logo");
      },
      function() {
          $(".navbar-header").removeClass("expand-logo");
      }
  );
  // this is for close icon when navigation open in mobile view
  $(".nav-toggler").on('click', function() {
      $("#main-wrapper").toggleClass("show-sidebar");
      $(".nav-toggler i").toggleClass("ti-menu");
  });
  $(".nav-lock").on('click', function() {
      $("body").toggleClass("lock-nav");
      $(".nav-lock i").toggleClass("mdi-toggle-switch-off");
      $("body, .page-wrapper").trigger("resize");
  });
  $(".search-box a, .search-box .app-search .srh-btn").on('click', function() {
      $(".app-search").toggle(200);
      $(".app-search input").focus();
  });

  // ============================================================== 
  // Right sidebar options
  // ==============================================================
  $(function() {
      $(".service-panel-toggle").on('click', function() {
          $(".customizer").toggleClass('show-service-panel');

      });
      $('.page-wrapper').on('click', function() {
          $(".customizer").removeClass('show-service-panel');
      });
  });
  // ============================================================== 
  // This is for the floating labels
  // ============================================================== 
  $('.floating-labels .form-control').on('focus blur', function(e) {
      $(this).parents('.form-group').toggleClass('focused', (e.type === 'focus' || this.value.length > 0));
  }).trigger('blur');

  // ============================================================== 
  //tooltip
  // ============================================================== 
  $(function() {
      $('[data-toggle="tooltip"]').tooltip()
  })
  // ============================================================== 
  //Popover
  // ============================================================== 
  $(function() {
      $('[data-toggle="popover"]').popover()
  })

  // ============================================================== 
  // Perfact scrollbar
  // ============================================================== 
  $('.message-center, .customizer-body, .scrollable').perfectScrollbar({
      wheelPropagation: !0
  });

  /*var ps = new PerfectScrollbar('.message-body');
  var ps = new PerfectScrollbar('.notifications');
  var ps = new PerfectScrollbar('.scroll-sidebar');
  var ps = new PerfectScrollbar('.customizer-body');*/

  // ============================================================== 
  // Resize all elements
  // ============================================================== 
  $("body, .page-wrapper").trigger("resize");
  $(".page-wrapper").show();
  // ============================================================== 
  // To do list
  // ============================================================== 
  $(".list-task li label").click(function() {
      $(this).toggleClass("task-done");
  });

  //****************************
  /* This is for the mini-sidebar if width is less then 1170*/
  //**************************** 
  var setsidebartype = function() {
      var width = (window.innerWidth > 0) ? window.innerWidth : this.screen.width;
      if (width < 1170) {
          $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
      } else {
          $("#main-wrapper").attr("data-sidebartype", "full");
      }
  };
  $(window).ready(setsidebartype);
  $(window).on("resize", setsidebartype);
  //****************************
  /* This is for sidebartoggler*/
  //****************************
  $('.sidebartoggler').on("click", function() {
      $("#main-wrapper").toggleClass("mini-sidebar");
      if ($("#main-wrapper").hasClass("mini-sidebar")) {
          $(".sidebartoggler").prop("checked", !0);
          $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
      } else {
          $(".sidebartoggler").prop("checked", !1);
          $("#main-wrapper").attr("data-sidebartype", "full");
      }
  });

  setTimeout(function() {
    $(".alert").alert('close');
    $(".errortext").remove();
  }, 3000);

  var base_url = window.location.origin;
  $('#product_category').on('change',function(){
    var catName = $(this).val();  
    if(catName){
      $.ajax({
        headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
        type:"GET",
        url: base_url + '/autosheba/public/admin/loadSubCategory/'+catName,
        success:function(response) {               
          if(response) {
              $("#product_subcategory").empty();
              if(response.msg == "OKK") {
                $("#product_subcategory").removeAttr('required');
                $("#subCategoryDiv").css("display", "none");
                console.log('This is ok');
              } else {
                $("#subCategoryDiv").css("display", "block");
                $("#product_subcategory").attr('required', 'required');
                for (var k in response){
                  if (response.hasOwnProperty(k)) {
                    $('#product_subcategory').append('<option value="'+ response[k].id +'">'+ response[k].subcategory_name +'</option>');
                  }
                }
              }
              console.log(response);
          } else {
              $("#product_subcategory").empty();
          }
        }
      });
    }else{
      $("#product_subcategory").empty();
    }
  });

  //Add Category Type With Ajax

  $('#addCategoryType').click(function() {
    $('#addingDataModal').modal('show');
    var data = '/autosheba/public/admin/loadCategoryTypeForm';
    loadAjaxForm(data);
  });

  $('#modalClose').click(function() {
      $('#addingDataModal').modal('hide');
      $('#addingDataModalBody').html('');
  });
    
    

  function loadAjaxForm(loadurl){
    $.ajax({
        headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
        type:'GET',
        url: base_url+loadurl,
        beforeSend: function()
        {
          $('#addingDataModalBody').html('Loading...');
        },
        success:function(data) {
          $('#addingDataModalBody').html(data.html);
        },
        complete: function (data) {
          $("#createCategoryTypeWithAjax").on('submit', function(e) {
            e.preventDefault();
            var data = $(this).serialize();
            var posturl = base_url + '/autosheba/public/admin/saveCategoryType';
            var optionaldata = "addCategoryType";
            postAjaxRequest(data, posturl, optionaldata);
          });
        }
    });
  }

  function postAjaxRequest(postdata, posturl, _dataoptional){
    $.ajax({
      headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
      type:'POST',
      url: posturl,
      data: postdata,
      success:function(data) {
        $('#addingDataModal').modal('hide');
        $('#addingDataModalBody').html('');
        $('#category_type').append('<option value="'+data.id+'">'+ data.category_type +'</option>');
        console.log(data);            
      },
      error: function(data){
        var errors = data.responseJSON;
        console.log(errors);
        var errorsHtml = '<div class="alert alert-danger"><ul>';
        $.each(errors.errors, function( key, value ) {
          errorsHtml += '<li>'+ value + '</li>';
        });
        errorsHtml += '</ul></div>';
        $( '#form-errors' ).html(errorsHtml);
      },
      complete: function (data) {
        setTimeout(function() {
          $(".alert").alert('close');
          $(".errortext").remove();
        }, 3000);
      }
    });
  }

  $('#item_category').on('change',function(){
    var categoryID = $(this).val(); 
    if(categoryID){
      $.ajax({
        headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
        type:"GET",
        url: base_url + '/autosheba/public/admin/loadItemSubCategoryWithItemType/'+categoryID,
        success:function(response) { 
          if(response) {
            $("#item_subcategories").empty();
            $("#item_type").empty();
            $("#item_subcategories").removeAttr('required');
            $("#item_type").removeAttr('required');
            $("#subCategoryDiv").css("display", "none"); 
            $("#itemTypeDiv").css("display", "none"); 
            if(response.subcategories.length > 0) {
              $("#subCategoryDiv").css("display", "block");
              $("#item_subcategories").attr('required', 'required');
              for (var k in response.subcategories){
                if (response.subcategories.hasOwnProperty(k)) {
                  $('#item_subcategories').append('<option value="'+ response.subcategories[k].id +'">'+ response.subcategories[k].subcategory_name +'</option>');
                }
              }
            }

            if(response.categoryType != null){
              $("#itemTypeDiv").css("display", "block");
              $("#item_type").attr('required', 'required');
              $('#item_type').append('<option value="'+ response.categoryType.id +'">'+ response.categoryType.category_type +'</option>');
            }         
          } else {
            $("#item_subcategories").empty();
            $("#item_type").empty();
          }
        }
      });
    } else {
      $("#item_subcategories").empty();
    }
  });

  $('#color').colorpicker({});
    
    $('#modalClose').click(function() {
        $('#addingDataModal').modal('hide');
        $('#addingDataModalBody').html('');
    });
    
    
    
  //Show TextBox when checkbox is checked
  $('input.checkboxSingle').change(function(){
    if ($('.checkBoxYes').is(':checked')) {
      $("div.checkBoxEnableDiv").css("display", "block");
      $("div.checkBoxEnableEditDiv").css("display", "block");


    } else {
      $("div.checkBoxEnableDiv").css("display", "none");
      $("div.checkBoxEnableEditDiv").css("display", "none");
    
    }
  }).change();

  $('.checkboxSingle').click(function() {
    $('.checkboxSingle').not(this).prop('checked', false);
  });

});